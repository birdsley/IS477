**Final Project: Air Quality and its Effects on Asthma**
--
Contributors:
  Sam Birdsley & 
  Michael Strobl
--

This repository explores the links between asthma and poor air quality over time. Our data workflow allows us to acquire, process, save, and document all data necessary to reproduce the results.

**Reproducibility**

To achieve the results we have obtained, all you have to do is go to the 'Actions' tab of our repository, and then run the master workflow. This can be done manually and will trigger our workflow automation python script. This will run all of our python scripts in the correct manner. From here, you must download the artificat from the workflow where you can view the results, as well as all the version of our data. We chose to do this as it was considered best practice for a GitHub workflow. If there are any questions on how to achieve these results, please reach out.

If you choose to run the results in your own envionrment based on the scripts we have provided, you will need the following libraries: Subprocess, os, sys, pandas, requests, numpy, seaborn, zipfile, io, StringIO, hashlib, json, re, sqlite3, and matplotlib.

Additionally, our raw, processed, and joined data can also be viewed here along with the final results: https://uofi.app.box.com/folder/354716358671. All course staff should have access, but if this is an issue please reach out to samuel36@illinois.edu or mstrobl3@illinois.edu.

**Summary**

The goal of our project was to investigate the statistical correlation between poor air quality and asthma rates in the same counties. Within our automated workflow, we have multiple Python scripts that retrieve the data, ensure its integrity, profile it, clean it, integrate it, store it, and analyze it. We retrieved open-source data from two different United States government agencies. We determined that the best course of action was to offset the asthma data by 2 years so that we can measure the direct effects of the air quality data as well. The data was retrieved directly via a request command, and the links to the data are included in the code and in this documentation. It is important to note that both datasets contained different counties, so we were unable to use either dataset in its entirety. Certain states were included in one dataset but not the other, resulting in a relatively low number of matches compared to either full dataset. We decided to look into this topic because we both know people with asthma and were interested in the statistical correlation between the two factors. We want to understand the mechanisms that lead to health disparities and how specific groups are affected by them.

Furthermore, when it was time to do the analysis, something we realized was that most counties have excellent air quality. Poor air quality is often found in large cities and occurs only a few days out of the year. A good example of this is Chicago, which had a few days of poor air quality due to wildfires last summer, but is usually positive overall. This made the analysis difficult because many of these cities attract affluent people who move there later in life, after they have passed the developmental stage when most people get asthma. Furthermore, in rural counties that have high levels of asthma, there are other factors affecting these people. As we will mention later, a good next step could be adding a third data source that has income level as well. This way, we can explore another factor that may help explain our asthma levels.

The final output of this project is an artifact that can be downloaded from the automated workflow that the user can trigger. Once the workflow has run all the scripts, the results and different stages of data can be viewed. We considered pushing the results back to the repository, but this was deemed a bad practice when the workflow involves the user retrieving raw data.

**Data Acquisition Documentation**

1. Air Quality Data - EPA Air Quality System (2018)
We obtained annual county-level air quality data from the EPA’s Air Quality System (AQS). This dataset contains detailed measurements from monitoring sites in specific counties (note: not all U.S. counties are included). The year of the data that we chose was 2018. This is due to the fact that the asthma data was from 2020, and we wanted to ensure a gap in the data to measure cause and effect. We chose a two year gap is this was cited by researchers as an appropriate time window.

Schema:

| Field Name                          | Description                                               | Type   |
| ----------------------------------- | --------------------------------------------------------- | ------ |
| State                               | Name of the state                                         | object |
| County                              | Name of the county                                        | object |
| Year                                | Reporting year                                            | int64  |
| Days with AQI                       | Total number of days in the year with a valid AQI reading | int64  |
| Good Days                           | Days with AQI 0–50 (Good)                                 | int64  |
| Moderate Days                       | Days with AQI 51–100 (Moderate)                           | int64  |
| Unhealthy for Sensitive Groups Days | Days with AQI 101–150 (USG)                               | int64  |
| Unhealthy Days                      | Days with AQI 151–200 (Unhealthy)                         | int64  |
| Very Unhealthy Days                 | Days with AQI 201–300 (Very Unhealthy)                    | int64  |
| Hazardous Days                      | Days with AQI 301–500 (Hazardous)                         | int64  |
| Max AQI                             | Highest AQI recorded during the year                      | int64  |
| 90th Percentile AQI                 | AQI value at the 90th percentile                          | int64  |
| Median AQI                          | Median AQI for the year                                   | int64  |
| Days CO                             | Number of days where CO was the primary pollutant         | int64  |
| Days NO2                            | Number of days where NO₂ was the primary pollutant        | int64  |
| Days Ozone                          | Number of days where Ozone was the primary pollutant      | int64  |
| Days PM2.5                          | Number of days where PM2.5 was the primary pollutant      | int64  |
| Days PM10                           | Number of days where PM10 was the primary pollutant       | int64  |




2. Asthma Data - CDC PLACES (2020)
Asthma data was acquired from the CDC (Center for Disease Control). For our analysis, we focused on columns starting with CASTHMA_, which indicate the frequency of asthma in U.S. counties. We queried data for 2020, based on research suggesting that the negative effects of poor air quality on asthma prevalence may take 12–24 months to come into effect.

Schema:

| Field Name        | Description                                                                      | Standardized Name | Type   |
| ----------------- | -------------------------------------------------------------------------------- | ----------------- | ------ |
| StateAbbr         | State abbreviation                                                               | stateabbr         | object |
| StateDesc         | State name                                                                       | statedesc         | object |
| CountyName        | County name                                                                      | countyname        | object |
| CountyFIPS        | County FIPS code                                                                 | countyfips        | objec  |
| TotalPopulation   | 2018 population estimate                                                         | totalpopulation   | int64  |
| CASTHMA_CrudePrev | Model-based estimate of crude prevalence of current asthma among adults aged ≥18 | casthma_crudeprev | float64|
| CASTHMA_Crude95CI | Estimated confidence interval for crude prevalence                               | casthma_crude95ci | object |
| CASTHMA_AdjPrev   | Model-based estimate of age-adjusted prevalence of asthma                        | casthma_adjprev   | float64|
| CASTHMA_Adj95CI   | Estimated confidence interval for age-adjusted prevalence                        | casthma_adj95ci   | object |





The data can be accessed and assessed using the following URL’s:

Asthma data: https://data.cdc.gov/500-Cities-Places/PLACES-County-Data-GIS-Friendly-Format-2020-releas/mssc-ksj7/about_data

Air Quality Data: https://aqs.epa.gov/aqsweb/airdata/download_files.html


**Data Integrity Verification**

This script inspects the integrity of the data we download by generating SHA-256 checksums for the raw data retrieved in the acquisition phase. This allows for other uses to check integrity and ensure that the original files have not been altered.

The compute function finds the raw data according to a specified file path. After this is done, the function returns a SHA256 hexadecimal string and saves this as a JSON. The JSON’s are saved in a ‘checksums’ folder located within the data branch. As long as the correct file paths are specified to find the raw data, this script will run and save to the correct location.

**Data Profiling** 
When we started the project, data profiling was one of the most important steps because it told us exactly what we were working with before we jumped into cleaning or analysis. At first we thought both datasets would line up pretty naturally since they were both county level information, but profiling showed that this was not really the case. The EPA air quality dataset does not include every county in the United States. It only includes counties that actually have monitoring equipment, which is way fewer than the total amount of counties. Once we saw this, we knew ahead of time that our final merged dataset would only include around three hundred counties. Instead of trying to fix this or fill in fake values, we made the decision that it was better to accept this number and work honestly with the data we really had. Profiling helped us understand that this smaller sample size was expected and totally normal for EPA data. The profiling report we created showed the number of rows, columns, missing values and duplicate rows in each dataset. This helped us see where the trouble spots were. For example, the air quality dataset had county names written in different formats. Some included words like County or Parish and others did not. Some had extra spaces at the end or beginning. The state names also had mixed capitalization. These problems would have made merging impossible if we ignored them. Profiling made these issues obvious so we could fix them later in cleaning. We also saw the numeric columns for Good Days, Moderate Days and the unhealthy categories and made sure they were realistic. A surprising thing we noticed was that the total Days with AQI did not always match the sum of all the categories. This meant the dataset had some inconsistencies that we needed to handle. Without profiling we probably would not have noticed this until way later. Profiling the asthma dataset also showed a lot of details that changed our cleaning decisions. The asthma data had confidence intervals stored as text which meant they could not be used in any numeric work until we parsed them. The dataset also had a weird field for geolocation where the latitude and longitude were hidden inside a string. We had to decide what to do with them and profiling helped us see that we could extract these numbers with regular expressions. The FIPS codes also came in different formats, sometimes with missing zeros. If we did not catch this early then none of the counties would match later during the join. Another important thing we noticed from profiling was how the actual values were shaped. The distributions for air quality values showed that most counties had mostly good air and only a few had large numbers of unhealthy or very unhealthy days. This matched real world patterns because most places in the United States do not have extremely bad pollution except during special events like wildfires. We knew this would probably lower the strength of correlations later on, since correlation needs variation in both variables to show a strong relationship. Profiling helped us understand that the dataset itself naturally leaned toward clean air and average asthma numbers for most counties. So we set our expectations realistically. Profiling did not just show problems. It helped us make smart decisions about what was worth fixing and what we should just accept. For example, instead of trying to force more counties into the final merged dataset, we accepted that only about 327 counties had both types of data. This decision kept the project honest and avoided false signals. Profiling also helped us think ahead about how the analysis might turn out. We saw that both variables do not vary extremely across most counties which explains why later correlations came out weak. The profiling step basically gave us the map for the entire workflow. It showed what issues existed, what to expect later on, and what choices we needed to make to keep our work believable and reproducible. By the end, profiling was not just a checkup step. It was a key part of shaping the project and making sure the rest of the workflow was built on solid understanding instead of guessing.

**Data Cleaning** 
For cleaning we took all the issues from profiling and fixed them one by one. We cleaned county and state names by stripping spaces and making them match across both datasets. We also removed things like County and Parish from the names so merging would be more accurate. This was important since the join depends on matching text exactly and even a small space can break everything. We converted numeric fields to real numbers and forced impossible values like negative asthma prevalence or values over one hundred to become missing instead. This made the dataset more believable and prevented weird spikes in analysis. For the EPA dataset we fixed the mismatches between category days and total Days with AQI by adjusting Moderate Days which was the safest category to change. Wild Max AQI values over five hundred were clipped since that number is the absolute upper limit. In the asthma dataset we had to parse confidence intervals from strings into numeric low and high values. We also extracted latitude and longitude from the geolocation field so it could be used later if needed. The CDC data had the county FIPS stored different ways so we changed them to always be five digits. Most of the cleaning decisions came from real problems we found so nothing was random. We chose conservative edits to keep the analysis legitimate rather than making crazy assumptions that would change the results.

**Database Connection**
Once both datasets were cleaned we saved them into a SQLite database. This made the workflow easier to repeat because anyone can rebuild the same database just by running the scripts again. SQLite was a good choice since it does not need any kind of server and it works pretty much anywhere. We stored the air quality table and the asthma table exactly the way they looked after cleaning, so we always have a stable version of both datasets saved in one place. This also kept everything more organized and made it simpler to load the data for merging and analysis later on.

**Data Integration**
When we integrated the two datasets, we quickly saw that they did not cover all the same counties or even the same states. The EPA air quality data only includes counties with actual monitoring stations, while the CDC asthma dataset includes every county in the country. Because of this, the overlap between them was much smaller than the full datasets. After cleaning and standardizing the county and state names so they would match, the merge produced 327 counties that existed in both sources. We decided not to force extra matches or fill in missing places because that would make the results unreliable. Accepting the 327 real matches kept the project honest and also helped explain why the analysis later showed weak correlations, since the shared counties mostly had similar air quality levels.

**Analysis**
After we finished cleaning and merging the datasets, we finally had everything in one place and could start looking at what the data was actually telling us. Because the merged dataset only had 327 counties and most counties in the United States experience mostly clean air for most of the year, we already expected that any relationship between asthma and air quality would probably not be extremely strong. The analysis ended up matching that expectation, but it was still useful to see how the data behaved through all the visualizations. We started by looking at the distribution plots. The asthma crude prevalence values were very tight, with most counties sitting in about the same range. There were no big spikes or outliers that pointed to extreme situations. The air quality variables behaved in a similar way. Almost all counties had mostly Good Days, and only a few had larger numbers for Unhealthy or Very Unhealthy Days. This is normal because large pollution events do not happen everywhere and that often. Seeing this helped us understand why stronger statistical relationships might not show up later. Next, we used the full correlation heatmap. The air quality metrics showed some normal relationships with each other, but the asthma columns did not show strong connections with any of the air quality ones.  One clear example is the correlation between asthma crude prevalence and Max AQI. The correlation there was –0.0381, which is a very small number. A correlation this weak suggests that in our dataset, asthma prevalence does not move very closely with how bad the worst air pollution days were. It does not mean there is no relationship in real life, but just that in our sample the connection is not strong enough to stand out. We also built a smaller correlation matrix that focused only on asthma-related columns and a few selected air quality values. Even in this close-up view, the results still showed weak relationships. Nothing pointed toward a strong trend. The scatterplots backed this up too. When we plotted asthma prevalence against values like Max AQI or Unhealthy Days, the points were spread out everywhere without a clear direction. The regression lines were almost flat but still had some movement which fits with the idea that the relationship is weak, not totally absent. One of the more interesting visualizations came from ranking the 10 counties with the highest Max AQI. These counties should be the ones with the worst air pollution conditions in our dataset. When we compared their asthma crude prevalence values, they did not show any major jump. A few were a little higher than average and a few were a little lower. Most were near the mean line we added. This suggests that while air quality is probably one factor that matters, asthma at the county level is likely shaped by many other things too, such as healthcare access, population age, smoking rates, housing conditions, or long-term exposure patterns that a single-year dataset cannot fully show. Putting everything together the results simply show that in this specific dataset, the connection between poor air quality and asthma prevalence is not very strong. The weak correlation values, including the –0.0381 one, match what you would expect from data that does not vary that much across the country. This does not mean air quality has no impact on asthma. It just means our dataset did not capture enough variation or the right conditions to show a clearer signal. Overall, the analysis step confirmed that our workflow ran correctly, produced clean visuals, and gave us honest results. Even though the correlations were not strong, the analysis still helped us understand the limits of this dataset and why the patterns came out the way they did.

**Future Work**
When we finished the project, it became pretty clear that there is still a lot more that could be done to get stronger and more useful results. A big thing we learned is that our analysis is only as good as the data we have. Even though we did everything right with cleaning, joining and running the workflow, the limits of the datasets shaped almost everything. So future work would mostly focus on getting better data and adding more pieces that we could not include this time. One of the biggest limits was the size of the merged dataset. We only ended up with 327 counties, and that was not because of mistakes in our work. The EPA only reports air quality for counties that have real monitors while the CDC gives asthma numbers for all counties. Because of that mismatch, the overlap was pretty small. In the future, we could bring in more years of EPA data so we get more counties. Some counties might have monitors in other years, and that would give us more matches and more variety. Having data for several years would also let us see trends instead of just one moment. For example, if a county’s air got worse for three years in a row, we could see if asthma rose after that. That would tell us way more about cause and effect. Another big thing we learned is that asthma has many reasons behind it besides air quality. Right now our project only looks at outdoor air pollution, which leaves out a ton of important stuff. Things like income levels, education, smoking rates, housing quality, health insurance, and population density all affect asthma. Since we didn’t include any of these, the results are kind of limited. This might be a huge reason why our correlation was so weak. In future work, we should add Census data or public health data so we can control for these factors. That way we could answer a better question, like does bad air still matter even when income is the same or when healthcare access is similar. Adding these variables would make the study a lot more real. There is also a lot more we could do with modeling. Correlation is useful but it is very simple and does not show deeper patterns. Future work could use regression or even machine learning models to measure how air quality impacts asthma while controlling for other things. These models could also make predictions, like which counties might see asthma increases in the next years based on their air trends. That would be more helpful than just saying the correlation is weak. Another lesson we learned is that most counties in the dataset have pretty clean air. Only a few have really bad readings. This means the numbers cluster together which makes strong correlations almost impossible. In future work, it might make sense to study certain regions instead of the whole country. For example, areas with wildfires, big factories, or heavy traffic might show stronger patterns if we study them on their own. We could also improve the workflow by adding more checks, better logging, or even making a dashboard so people can explore the results without running code. Overall, the main lesson is that air quality alone cannot explain asthma levels. Our results don’t mean there is no relationship. They just mean we need more data and more factors to understand the real story. With more years, more variables, and more models, the project could be much stronger in the future.

**Work Cited**

GitHub Documentation. (2024). About workflow artifacts. GitHub Docs. https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts

American Lung Association. (2025, May 9). Understanding the strong link between air pollution and asthma. American Lung Association. https://www.lung.org/blog/asthma-and-air-pollution
